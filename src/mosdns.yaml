log:
    file: ""
    level: error

plugins:
#cnfall  - tag: cn_test
#cnfall    type: forward
#cnfall    args:
#cnfall      concurrent: 3
#cnfall      upstreams:
#cnfall        - addr: "udp://127.0.0.1:5301"
#cnfall        - addr: "udp://223.5.5.5"
#cnfall        - addr: "udp://119.29.29.29"

  - tag: local_unbound
    type: forward
    args:
      upstreams:
        - addr: "udp://127.0.0.1:5301"

#custfw  - tag: force_forward
#custfw    type: forward
#custfw    args:
#custfw      upstreams:
#custfw        - addr: "udp://{CUSTOM_FORWARD}"

#emptcusfw  - tag: forward_unbound
#emptcusfw    type: forward
#emptcusfw    args:
#emptcusfw      concurrent: 2
#emptcusfw      upstreams:
#emptcusfw        - addr: "udp://127.0.0.1:5304"
#emptcusfw#nosocks        - addr: "udp://127.0.0.1:5302"
#emptcusfw#socksok        - addr: "udp://127.0.0.1:5303"

#emptcusfw  - tag: forward_dnscrypt
#emptcusfw    type: forward
#emptcusfw    args:
#emptcusfw      upstreams:
#emptcusfw        - addr: "udp://127.0.0.1:5302"

  - tag: cnip
    type: mmdb
    args:
      file: "/data/Country-only-cn-private.mmdb"

  - tag: main_sequence
    type: sequence
    args:
        - matches: qtype 65
          exec: reject 0
        - matches: 
#ipv6ok          - qname &/data/force_nocn_list.txt
          - qtype 28
          exec: reject 0
        - matches: 
          - "!qtype 1 2 5 28 15 16 33 6 99"
          exec: $local_unbound
        - matches: has_wanted_ans
          exec: accept
#custfw        - matches: qname &/data/force_forward_list.txt
#custfw          exec: $force_forward
#custfw        - matches: has_wanted_ans
#custfw          exec: accept
#emptcusfw        - matches: qname &/data/force_nocn_list.txt
#emptcusfw          exec: $forward_unbound
#emptcusfw        - matches: has_wanted_ans
#emptcusfw          exec: accept
        - matches: qname &/data/force_cn_list.txt
          exec: $local_unbound
        - matches: has_wanted_ans
          exec: accept
#cnfall        - exec: cache 1024
#cnfall        - matches: has_wanted_ans
#cnfall          exec: accept
#nofall        - exec: $local_unbound
#cnfall        - exec: $cn_test
        - matches: resp_ip_mmdb $cnip CN
          exec: accept
        - exec: drop_resp
#ipv6ok        - exec: prefer_ipv4
#emptcusfw        - exec: $forward_unbound
#emptcusfw        - matches: has_wanted_ans
#emptcusfw          exec: accept
#emptcusfw        - exec: $forward_dnscrypt
#emptcusfw        - exec: accept
#nocncusfw        - exec: $force_forward
#nocncusfw        - exec: accept

  - tag: udp_server
    type: udp_server
    args:
      entry: main_sequence
      listen: :53
  - tag: "tcp_server"
    type: "tcp_server"
    args:
      entry: main_sequence
      listen: :53
      idle_timeout: 5